#include <stdio.h>
#include <stdlib.h>
#include <string.h>

struct symbtab {
    char label[10];
    int addr;
    struct symbtab *next;
};

struct symbtab *first = NULL, *last = NULL;
int size = 0;

// Function declarations
void insert();
void del();
int search(char lab[]);
void modify();
void display();

int main() {
    int op, y;
    char la[10];

    printf("Name: Alisha Khatri\n");
    printf("Roll no: 03\n");
    printf("Lab no: Symbol Table Implementation\n");

    do {
        printf("\nSymbol Table Menu:\n");
        printf("1. Insert\n");
        printf("2. Display\n");
        printf("3. Delete\n");
        printf("4. Search\n");
        printf("5. Modify\n");
        printf("6. Exit\n");
        printf("Enter your option: ");
        scanf("%d", &op);

        switch(op) {
            case 1:
                insert();
                break;
            case 2:
                display();
                break;
            case 3:
                del();
                break;
            case 4:
                printf("Enter the label to be searched: ");
                scanf("%s", la);
                y = search(la);
                if(y == 1)
                    printf("The label '%s' is in the symbol table.\n", la);
                else
                    printf("The label '%s' is NOT found in the symbol table.\n", la);
                break;
            case 5:
                modify();
                break;
            case 6:
                printf("Exiting...\n");
                break;
            default:
                printf("Invalid option! Try again.\n");
        }
    } while(op != 6);

    return 0;
}

// Insert a new symbol
void insert() {
    char l[10];
    int n;

    printf("Enter the label: ");
    scanf("%s", l);

    n = search(l);
    if(n == 1) {
        printf("The label already exists. Duplicate can't be inserted.\n");
        return;
    }

    struct symbtab *p = (struct symbtab*)malloc(sizeof(struct symbtab));
    strcpy(p->label, l);
    printf("Enter the address: ");
    scanf("%d", &p->addr);
    p->next = NULL;

    if(size == 0) {
        first = last = p;
    } else {
        last->next = p;
        last = p;
    }
    size++;
    printf("Label inserted successfully.\n");
}

// Display symbol table
void display() {
    if(size == 0) {
        printf("Symbol table is empty.\n");
        return;
    }

    struct symbtab *p = first;
    printf("\nLabel\tAddress\n");
    printf("-----------------\n");
    while(p != NULL) {
        printf("%s\t%d\n", p->label, p->addr);
        p = p->next;
    }
}

// Search a label
int search(char lab[]) {
    struct symbtab *p = first;
    while(p != NULL) {
        if(strcmp(p->label, lab) == 0)
            return 1;
        p = p->next;
    }
    return 0;
}

// Modify a label or address
void modify() {
    char l[10], nl[10];
    int add, choice;
    struct symbtab *p = first;

    if(size == 0) {
        printf("Symbol table is empty.\n");
        return;
    }

    printf("What do you want to modify?\n");
    printf("1. Only the label\n");
    printf("2. Only the address\n");
    printf("3. Both label and address\n");
    printf("Enter your choice: ");
    scanf("%d", &choice);

    switch(choice) {
        case 1:
            printf("Enter the old label: ");
            scanf("%s", l);
            if(search(l) == 0) {
                printf("No such label.\n");
                return;
            }
            printf("Enter the new label: ");
            scanf("%s", nl);
            while(p != NULL) {
                if(strcmp(p->label, l) == 0) {
                    strcpy(p->label, nl);
                    printf("Label updated successfully.\n");
                    return;
                }
                p = p->next;
            }
            break;

        case 2:
            printf("Enter the label whose address is to be modified: ");
            scanf("%s", l);
            if(search(l) == 0) {
                printf("No such label.\n");
                return;
            }
            printf("Enter the new address: ");
            scanf("%d", &add);
            while(p != NULL) {
                if(strcmp(p->label, l) == 0) {
                    p->addr = add;
                    printf("Address updated successfully.\n");
                    return;
                }
                p = p->next;
            }
            break;

        case 3:
            printf("Enter the old label: ");
            scanf("%s", l);
            if(search(l) == 0) {
                printf("No such label.\n");
                return;
            }
            printf("Enter the new label: ");
            scanf("%s", nl);
            printf("Enter the new address: ");
            scanf("%d", &add);
            while(p != NULL) {
                if(strcmp(p->label, l) == 0) {
                    strcpy(p->label, nl);
                    p->addr = add;
                    printf("Label and address updated successfully.\n");
                    return;
                }
                p = p->next;
            }
            break;

        default:
            printf("Invalid choice.\n");
    }
}

// Delete a label
void del() {
    char l[10];
    struct symbtab *p = first, *prev = NULL;

    if(size == 0) {
        printf("Symbol table is empty.\n");
        return;
    }

    printf("Enter the label to be deleted: ");
    scanf("%s", l);

    if(search(l) == 0) {
        printf("Label not found.\n");
        return;
    }

    // Deleting first node
    if(strcmp(first->label, l) == 0) {
        struct symbtab *temp = first;
        first = first->next;
        free(temp);
        size--;
        printf("Label deleted successfully.\n");
        return;
    }

    // Deleting other nodes
    while(p != NULL && strcmp(p->label, l) != 0) {
        prev = p;
        p = p->next;
    }

    if(p != NULL) {
        prev->next = p->next;
        if(p == last) last = prev;
        free(p);
        size--;
        printf("Label deleted successfully.\n");
    }
}
